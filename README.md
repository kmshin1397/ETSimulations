# ETSimulations
Automated pipeline to generate and process simulated cryo-electron tomography data

Full documentation available online at : https://etsimulations.readthedocs.io/en/latest/index.html

This README serves to provide a quick overview of the capabilities of the software. It is recommended that you check out the official documentation link above for more detailed guidance if you are trying to use the software yourself.

## Getting started
The ETSimulations package is designed to be a tool to facilitate generation and processing of simulated cryo-electron tomography data. 

### External dependencies
The following external software is used by ETSimulations and should thus be installed first:

* Chimera - https://www.cgl.ucsf.edu/chimera/ (Only needed if you wish to simulate data sets)

* TEM-simulator - http://tem-simulator.sourceforge.net/ (Only needed if you wish to simulate data sets)

* Python 3.3 or greater

* Corresponding softwares for the various Processors (i.e. EMAN2 for the EMAN2 Processor) that you wish to run

### Setting up ETSimulations
To begin, navigate to a directory in which you want to install the package and run the following commands:

```
git clone https://github.com/kmshin1397/ETSimulations.git

cd ETSimulations

python3 -m venv env

source env/bin/activate

pip install -r requirements.txt
```

This will have downloaded the ETSimulations code and set up the necessary Python packages and environment.

### Running a simulation
Most all general parameter set up is done through a YAML file which is passed in as an argument to the main ets_run.py program. An example such YAML file is provided in the ETSimulations directory as "configs.yaml".

Detailed set-up with regards to the characteristics of the particles simulated are controlled through custom "Assembler" Python classes which can define a series of Chimera commands to open, manipulate, and combine one or more source maps, i.e. various proteins, into a fake particle source. (This is done for the T4SS simulations in the src/assemblers/t4ss_assembler.py file) Custom arguments to pass along to your custom particle Assemblers can also be defined in the configuration YAML file, as shown in the example.

To actually run a set of simulations, run (assuming you've activated the virtual environment as indicated above - the "source ..." command):

```
python src/ets_run.py -i configs.yaml
```

More details on the parameters available through the configurations can be found in the full user manual.

### Processing a simulated dataset
Another program called ets_process_data.py is provided to facilitate processing of the raw datasets generated by the simulations. Here as well, we provide input via a configuration YAML file. This time parameters are given to modules called "Processors". Each Processor module implements a function to take the inputted configurations and automatically set up tomogram reconstruction and sub-tomogram averaging. For example, the EMAN2 processor will automatically create an EMAN2 project and generate a Python script which will run all desired EMAN2 processing steps (i.e. e2import.py, e2tomogram.py, etc.) in order.

The YAML file provided to the ets_process_data.py run should have:
 * root: The path to the folder which contains the raw_data and sim_metadata.json files created by ets_generate_data.py
 * name: The project name - should be the same one used for the simulations
 * processors: A list of processor objects which have a "name" and "args" arguments. The specifics to what goes into these fields can be found in more details in the section of the manual particular to that processor.


To run the processor set up, run:

```
python src/ets_process_data.py -i processor_configs.yaml
```
